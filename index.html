<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ashen's Domain</title>
  <meta name="description" content="Ashen’s hub." />
  <meta name="theme-color" content="#120a1c" />

  <style>
    :root{
      --font: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
      --ashen-pink:#be0078;
      --ashen-purple:#8205b3;

      --bg0:#07060c;
      --bg1:#0b0812;

      --text: rgba(255,255,255,0.92);
      --textDim: rgba(255,255,255,0.72);

      --glass1: rgba(18,10,28,0.74);
      --glass2: rgba(10, 8,18,0.52);

      --stroke: rgba(255,255,255,0.10);

      --radius: 18px;
      --shadow: 0 18px 60px rgba(0,0,0,0.55);
      --glowP: rgba(130, 5,179,0.28);
      --glowM: rgba(190, 0,120,0.22);
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }

    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 12% 10%, rgba(190,0,120,0.22), transparent 55%),
        radial-gradient(900px 700px at 88% 22%, rgba(130,5,179,0.22), transparent 52%),
        radial-gradient(1200px 900px at 50% 90%, rgba(255,255,255,0.05), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .mist{
      position: fixed;
      inset: -40%;
      pointer-events:none;
      opacity: 0.22;
      filter: blur(22px);
      background:
        conic-gradient(from 180deg at 50% 50%,
          rgba(190,0,120,0.22),
          rgba(130,5,179,0.22),
          rgba(255,255,255,0.06),
          rgba(190,0,120,0.18)
        );
      animation: drift 14s ease-in-out infinite alternate;
      mix-blend-mode: screen;
    }
    @keyframes drift{
      0%{ transform: translate(-2%, -1%) rotate(-6deg) scale(1.04); }
      100%{ transform: translate(2%, 1%) rotate(6deg) scale(1.08); }
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:flex-start; /* was center */
      justify-content:center;
      padding: 28px 16px;
    }

    /* Wider on desktop so 2 + 3 feels premium, not cramped */
    .card{
      width: min(1040px, 100%);
      border-radius: calc(var(--radius) + 10px);
      background: linear-gradient(180deg, var(--glass1), var(--glass2));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      position: relative;
      overflow:hidden;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(135deg,
        rgba(190,0,120,0.45),
        rgba(130,5,179,0.40),
        rgba(255,255,255,0.10)
      );
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.7;
      pointer-events:none;
    }

    .cardInner{
      padding: 28px;
      position:relative;
      z-index:1;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      margin-bottom: 10px;
    }

    .title{
      margin:0;
      font-size: clamp(22px, 2.6vw, 30px);
      letter-spacing: 0.2px;
      line-height: 1.1;
    }

    .subtitle{
      margin: 8px 0 0;
      color: var(--textDim);
      line-height: 1.35;
      font-size: 14px;
      max-width: 68ch;
    }

    /* IMPORTANT: outer container is a vertical stack (prevents side-by-side section squish) */
    .sections{
      display:flex;
      flex-direction: column;
      gap: 18px;
      margin-top: 0;
    }

    .sectionTitle{
      margin: 6px 0 12px 2px;
      font-size: 16px;          /* bigger */
      font-weight: 700;         /* more presence */
      letter-spacing: 0.14em;   /* keeps the premium spacing */
      text-transform: uppercase;
      color: rgba(255,255,255,0.82);
      opacity: 0.95;
    }

    .grid{
      display:grid;
      gap: 14px;
    }

    /* Section-specific grids */
    .grid--wishlists{
      grid-template-columns: 1fr 1fr;
    }

    .grid--socials{
      grid-template-columns: repeat(3, 1fr);
    }

    .linkCard{
      display:block;
      text-decoration:none;
      color: var(--text);
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      overflow:hidden;
      position:relative;
      transition: transform 140ms ease, border-color 140ms ease, box-shadow 140ms ease;
      outline: none;
      min-width: 0;
    }

    .linkCard::after{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(600px 180px at 20% 0%,
        rgba(190,0,120,0.25),
        transparent 55%
      );
      opacity: 0.7;
      pointer-events:none;
    }

    .linkCard:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.20);
      box-shadow:
        0 18px 44px rgba(0,0,0,0.45),
        0 0 26px rgba(130,5,179,0.18),
        0 0 26px rgba(190,0,120,0.14);
    }

    .lcInner{
      padding: 18px 18px 16px;
      position:relative;
      z-index:1;
    }

    /* socials slightly tighter = looks intentional + premium */
    .grid--socials .lcInner{
      padding: 16px 16px 14px;
    }

    .lcTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      min-width: 0;
    }

    /* --- ICONS --- */
    .lcTitleRow{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0; /* lets title clamp properly */
    }

    .lcIcon{
      width: 18px;
      height: 18px;
      flex: 0 0 auto;
      opacity: 0.92;
      filter: drop-shadow(0 0 10px rgba(130,5,179,0.18)) drop-shadow(0 0 10px rgba(190,0,120,0.12));
    }

    .grid--socials .lcIcon{
      width: 17px;
      height: 17px;
    }

    .lcName{
      margin:0;
      font-weight: 700;
      font-size: 16px;
      letter-spacing: 0.2px;

      /* 2-line clamp */
      white-space: normal;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.2;
      min-width: 0;
    }

    .lcHint{
      margin: 10px 0 0;
      color: var(--textDim);
      font-size: 13px;
      line-height: 1.35;
    }

    /* socials: keep the handle visible, but not too tall */
    .grid--socials .lcHint{
      margin-top: 8px;
      font-size: 12.5px;
    }

    .pill{
      flex: 0 0 auto;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      white-space: nowrap;
    }

    .rail{
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width: 4px;
      background: linear-gradient(180deg, var(--ashen-pink), var(--ashen-purple));
      opacity: 0.95;
    }

    /* Responsive */
    @media (max-width: 900px){
      .grid--socials{ grid-template-columns: 1fr; }
    }

    @media (max-width: 700px){
      .cardInner{ padding: 20px; }
      .grid--wishlists{ grid-template-columns: 1fr; }
      .grid--socials{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="mist" aria-hidden="true"></div>

  <main class="wrap">
    <section class="card" aria-label="Ashen hub">
      <div class="cardInner">

        <!-- Sections render here -->
        <div class="sections" id="linksRoot" aria-live="polite"></div>

      </div>
    </section>
  </main>

  <script>
    (async function init(){
      const rootEl = document.getElementById("linksRoot");

      const escapeHtml = (str) => String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");

      const iconSvg = (id) => {
        const common = 'class="lcIcon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"';
        switch(String(id || "").toLowerCase()){
          case "twitch":
            return `<svg ${common}><path d="M6 5h14v10l-4 4h-4l-2 2H8v-2H6V5z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/><path d="M10 9v5M14 9v5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>`;
          case "youtube":
            return `<svg ${common}><path d="M10 9.5l6 3.5-6 3.5v-7z" fill="currentColor"/><path d="M21 12c0 4-1 6-9 6S3 16 3 12 4 6 12 6s9 2 9 6z" stroke="currentColor" stroke-width="1.8"/></svg>`;
          case "tiktok":
            return `<svg ${common}><path d="M14 6c1.1 1.7 2.7 2.7 4.5 2.9v3c-1.8-.1-3.4-.8-4.5-1.7v6.1c0 2.6-2.1 4.7-4.7 4.7S4.6 20.6 4.6 18s2.1-4.7 4.7-4.7c.3 0 .6 0 .9.1v3c-.3-.1-.6-.2-.9-.2-1 0-1.8.8-1.8 1.8s.8 1.8 1.8 1.8 1.8-.8 1.8-1.8V6h3z" fill="currentColor"/></svg>`;
          case "steam":
            return `<svg ${common}><path d="M7.5 16.5l2.6 1.1a3 3 0 104-4l-1.1-2.6A4.8 4.8 0 1110 19.6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><circle cx="15.8" cy="8.3" r="2.1" stroke="currentColor" stroke-width="1.8"/><circle cx="9.2" cy="17.2" r="1.2" fill="currentColor"/></svg>`;
          case "amazon":
            return `<svg ${common}><path d="M6.5 10.5c0-2.2 1.8-4 4-4H14c2.2 0 4 1.8 4 4v7H6.5v-7z" stroke="currentColor" stroke-width="1.8"/><path d="M9 10h6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><path d="M7 19.2c2.8 1.6 7.2 1.6 10 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>`;
          default:
            return `<svg ${common}><circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="1.8"/><path d="M12 8v4l3 2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
        }
      };

      // Loading state
      rootEl.innerHTML = `
        <div class="linkCard" style="pointer-events:none; opacity:0.85;">
          <div class="lcInner">
            <div class="lcTop">
              <h2 class="lcName">Loading…</h2>
              <span class="pill">links.json</span>
            </div>
            <p class="lcHint">Booting Ashen hub</p>
          </div>
        </div>
      `;

      try{
        const jsonUrl = new URL("links.json", window.location.href);
        const res = await fetch(jsonUrl, { cache: "no-store" });

        if(!res.ok){
          throw new Error(`HTTP ${res.status} while fetching links.json`);
        }

        const data = await res.json();

        // Theme
        const root = document.documentElement;
        const theme = data.theme || {};
        if (theme.font) root.style.setProperty("--font", theme.font);
        if (theme.ashenPink) root.style.setProperty("--ashen-pink", theme.ashenPink);
        if (theme.ashenPurple) root.style.setProperty("--ashen-purple", theme.ashenPurple);
        if (Number.isFinite(theme.radius)) root.style.setProperty("--radius", `${theme.radius}px`);

        // Page copy
        const page = data.page || {};
        const titleEl = document.querySelector(".title");
        if (page.title && titleEl){
          titleEl.textContent = page.title;
          document.title = `Ashen - ${page.title}`;
        }

        const subtitleEl = document.querySelector(".subtitle");
        if (page.subtitle && subtitleEl){
          subtitleEl.textContent = page.subtitle;
        }

        const sections = Array.isArray(data.sections) ? data.sections : [];
        const totalItems = sections.reduce((sum, s) => sum + (Array.isArray(s.items) ? s.items.length : 0), 0);

        if (totalItems === 0){
          rootEl.innerHTML = `
            <div class="linkCard" style="pointer-events:none; opacity:0.9;">
              <div class="lcInner">
                <div class="lcTop">
                  <h2 class="lcName">No links found</h2>
                  <span class="pill">Add items</span>
                </div>
                <p class="lcHint">Add items to sections[].items in links.json.</p>
              </div>
            </div>
          `;
          return;
        }

        const sectionHtml = sections.map(section => {
          const sectionName = String(section.name || "");
          const items = Array.isArray(section.items) ? section.items : [];
          if (items.length === 0) return "";

          const key = sectionName.trim().toLowerCase();
          const gridClass =
            key === "socials" ? "grid grid--socials" :
            key === "wishlists" ? "grid grid--wishlists" :
            "grid grid--wishlists";

          const cards = items.map(item => {
            const url = String(item.url || "#");
            const label = escapeHtml(item.label || "Link");
            const hint = escapeHtml(item.hint || "");
            const pill = escapeHtml(item.pill || "Open");

            const rail = item.rail || {};
            let railStyle = "";
            if (rail.type === "solid" && rail.color){
              railStyle = `background:${rail.color};`;
            } else if (rail.type === "gradient" && rail.from && rail.to){
              railStyle = `background:linear-gradient(180deg, ${rail.from}, ${rail.to});`;
            } else {
              railStyle = `background:linear-gradient(180deg, var(--ashen-pink), var(--ashen-purple));`;
            }

            return `
              <a class="linkCard" href="${url}" target="_blank" rel="noopener noreferrer">
                <span class="rail" aria-hidden="true" style="${railStyle}"></span>
                <div class="lcInner">
                  <div class="lcTop">
                  <div class="lcTitleRow">
                    ${iconSvg(item.id)}
                    <h3 class="lcName" title="${label}">${label}</h3>
                  </div>
                    <span class="pill">${pill}</span>
                  </div>
                  ${hint ? `<p class="lcHint">${hint}</p>` : ``}
                </div>
              </a>
            `;
          }).join("");

          return `
            <section>
              <div class="sectionTitle">${escapeHtml(sectionName)}</div>
              <div class="${gridClass}">
                ${cards}
              </div>
            </section>
          `;
        }).join("");

        rootEl.innerHTML = sectionHtml || "";

      } catch (err) {
        const attempted = new URL("links.json", window.location.href).toString();
        rootEl.innerHTML = `
          <div class="linkCard" style="pointer-events:none; opacity:0.9;">
            <div class="lcInner">
              <div class="lcTop">
                <h2 class="lcName">Couldn't load links.json</h2>
                <span class="pill">Debug</span>
              </div>
              <p class="lcHint">
                Tried: ${escapeHtml(attempted)}<br/>
                Error: ${escapeHtml(String(err.message || err))}
              </p>
            </div>
          </div>
        `;
        console.error(err);
      }
    })();
  </script>
</body>
</html>